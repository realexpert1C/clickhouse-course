# –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Ññ14 ‚Äî –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏–µ

---

‚úÖ –ò—Ç–æ–≥ –∏ –≤—ã–≤–æ–¥—ã
---------------

  

### üìå –ß–µ–º—É –Ω–∞—É—á–∏–ª—Å—è

  

‚úî –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ–º—É—é —Ç–∞–±–ª–∏—Ü—É –≤ ClickHouse

‚úî –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å 3 —Ä–µ–ø–ª–∏–∫–∏ —á–µ—Ä–µ–∑ –º–∞–∫—Ä–æ—Å {replica}

‚úî –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á–∞—Å—Ç–∏ –∏ —Ä–µ–ø–ª–∏–∫–∏ —á–µ—Ä–µ–∑ system.parts –∏ system.replicas

‚úî –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å TTL, —á—Ç–æ–±—ã –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π

* * *

### üõ† –ö–∞–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –±—ã–ª–∏

  

‚ùó –ë—ã–ª–∏ –æ—à–∏–±–∫–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –≤ ReplicatedMergeTree ‚Üí –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å ZooKeeper

‚ùó –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª remote() ‚Üí —Ä–µ—à–∏–ª —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ä–µ–ø–ª–∏–∫

* * *

### üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

  

–ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é: —Ç–∞–±–ª–∏—Ü–∞ —Ä–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞, —Ä–µ–ø–ª–∏–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã, TTL –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω.

---

# –î–ó-14. –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏–µ  

### üìÑ –¢–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è

> –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏–µ  
>
> **–¶–µ–ª—å:**
> - –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –≤ —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ–º—É—é;
> - –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–ø–ª–∏–∫–∏ –≤ ClickHouse;
> - —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ;
>
> **–û–ø–∏—Å–∞–Ω–∏–µ / —à–∞–≥–∏:**
> 1. –í–∑—è—Ç—å –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π dataset: https://clickhouse.com/docs/en/getting-started/example-datasets.
> 2. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –≤ —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ–º—É—é, –∏—Å–ø–æ–ª—å–∑—É—è –º–∞–∫—Ä–æ—Å `replica`.
> 3. –î–æ–±–∞–≤–∏—Ç—å 2 —Ä–µ–ø–ª–∏–∫–∏.
> 4. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∏ –æ—Ç–¥–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–∞–∫ 2 —Ñ–∞–π–ª–∞:
>    ```sql
>    SELECT getMacro('replica'), *
>    FROM remote('replica1,replica2,replica3', system.parts)
>    FORMAT JSONEachRow;
>
>    SELECT * FROM system.replicas
>    FORMAT JSONEachRow;
>    ```
> 5. –î–æ–±–∞–≤–∏—Ç—å –∏–ª–∏ –≤—ã–±—Ä–∞—Ç—å –∫–æ–ª–æ–Ω–∫—É —Å —Ç–∏–ø–æ–º `Date` –≤ —Ç–∞–±–ª–∏—Ü–µ.
>    –î–æ–±–∞–≤–∏—Ç—å TTL –Ω–∞ —Ç–∞–±–ª–∏—Ü—É: —Ö—Ä–∞–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π.
> 6. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ `SHOW CREATE TABLE <—Ç–∞–±–ª–∏—Ü–∞>`.
>
> **–ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏:**
> - –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞;
> - –î–æ–±–∞–≤–ª–µ–Ω—ã —Ä–µ–ø–ª–∏–∫–∏;
> - –í—ã–ø–æ–ª–Ω–µ–Ω—ã –∑–∞–ø—Ä–æ—Å—ã —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏;
> - –ù–∞—Å—Ç—Ä–æ–µ–Ω TTL —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π `SHOW CREATE TABLE`.

---

## –®–ê–ì 1 –í–∑—è—Ç—å –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç, –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –∏ —Å–¥–µ–ª–∞—Ç—å –µ–µ —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ–º–æ–π

### –¶–µ–ª—å —à–∞–≥–∞
–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –¥–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏

–î–ª—è —ç—Ç–æ–≥–æ —Ä–∞–∑–≤–µ—Ä–Ω—É ClickHouse LTS –≤–µ—Ä—Å–∏–∏ 25.3 –Ω–∞ –æ–¥–Ω–æ–π –Ω–æ–¥–µ `ch1`,  
–ø—Ä–æ–≤–µ—Ä—é –µ–µ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –¥–∞–ª—å–Ω–µ–π—à–∏–º —à–∞–≥–∞–º (–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö, —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ Keeper –∏ —Ä–µ–ø–ª–∏–∫). –î–∞–ª–µ–µ –∑–∞–≥—Ä—É–∂—É —Ç–µ—Å—Ç–æ–≤—ã–π –¥–∞—Ç–∞—Å–µ—Ç. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ–º–æ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–Ω–∞—á–∞–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–µ–π. –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Zookeeper. –ù–æ –¥–ª—è –Ω–µ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ Docker. –ü–æ–ø—Ä–æ–±—É—é –¥—Ä—É–≥–æ–π –≤–∞—Ä–∏–∞–Ω—Ç - —ç—Ç–æ Clickhouse Keeper - –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Å Clickhouse-Server –≤ –æ–¥–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ. –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Keeper –∏–∑–º–µ–Ω—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã ch1 –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é —Ç–∞–±–ª–∏—Ü—É –≤ Clickhouse Keeper. –ö—Ä–æ–º–µ —ç—Ç–æ–≥–æ, —è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–º –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É —Å —Ç–æ–π –∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π, –Ω–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –¥–≤–∏–∂–∫–∞ ReplicatedMergeTree –∏ –ø–µ—Ä–µ–ª—å—é –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –≤ —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ–º—É—é.

---

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–∞—Ç–∞–ª–æ–≥–æ–≤

–í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ–∑–¥–∞—é –æ—Ç–¥–µ–ª—å–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã ClickHouse-–∫–ª–∞—Å—Ç–µ—Ä–∞, —Ç–∞–∫ —É–¥–æ–±–Ω–µ–µ - —Ñ–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
–≤—Å–µ—Ö —Ä–µ–ø–ª–∏–∫ –∏ –∫–∏–ø–µ—Ä–∞ –≤ –æ–¥–Ω–æ–π –ø–∞–ø–∫–µ –Ω–∞ —Ö–æ—Å—Ç–µ. –≠—Ç–æ –¥–ª—è —É—á–µ–±–Ω—ã—Ö —Ü–µ–ª–µ–π, –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö –º–æ–≥—É—Ç –±—ã—Ç—å –≤—Å–µ –∫–∞—Ç–∞–ª–æ–≥–∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Ö–æ—Å—Ç–∞—Ö:

```bash
mkdir -p infra/ch-cluster/ch1/data
```
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤:
<pre>
infra/&nbsp;
&nbsp;‚îî‚îÄ‚îÄ ch-cluster/
    ‚îî‚îÄ‚îÄ ch1/
        ‚îú‚îÄ‚îÄ docker-compose.yml
        ‚îî‚îÄ‚îÄ data/
</pre>
---

2. __docker-compose.yaml__ –¥–ª—è ClickHouse (ch1)

–§–∞–π–ª: infra/ch-cluster/ch1/docker-compose.yaml

```xml
version: "3.8"

services:
  ch1:
    image: clickhouse/clickhouse-server:25.3
    container_name: ch1
    hostname: ch1
    ports:
      - "8123:8123"   # HTTP –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
      - "9000:9000"   # Native –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    volumes:
      - ./data:/var/lib/clickhouse
    ulimits:
      nofile:
        soft: 262144
        hard: 262144
```

---

3. –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ ClickHouse

–ü–µ—Ä–µ—Ö–æ–¥ –≤ –∫–∞—Ç–∞–ª–æ–≥ –∏ –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

```bash
cd infra/ch-cluster/ch1
docker compose up -d
```

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

```bash
docker ps
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
	‚Ä¢	–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä ch1 –≤ —Å—Ç–∞—Ç—É—Å–µ Up

---

4. –ó–∞–ø—É—Å–∫ ClickHouse-–∫–ª–∏–µ–Ω—Ç–∞ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ClickHouse —Å –ø–æ–º–æ—â—å—é –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞:

docker exec -it ch1 clickhouse-client

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
	‚Ä¢	—É—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
	‚Ä¢	–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Å–µ—Ä–≤–µ—Ä–∞

üì∏ –†–µ–∑—É–ª—å—Ç–∞—Ç —É—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ clickhouse-client
[hw14_ch_client]()

---

5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ ClickHouse

–í–Ω—É—Ç—Ä–∏ clickhouse-client –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã.

5.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ –∏ –∞–ø—Ç–∞–π–º–∞

```sql
SELECT
    version() AS version,
    uptime()  AS uptime_seconds;
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
	‚Ä¢	–≤–µ—Ä—Å–∏—è ClickHouse 25.3.x
	‚Ä¢	uptime_seconds > 0

üì∏ –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ SELECT version(), uptime()
[hw14_ch1_check1]()

---

5.2. –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

```sql
SHOW DATABASES;

SELECT 1;
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
	‚Ä¢	—Å–ø–∏—Å–æ–∫ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
	‚Ä¢	–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –ø—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å

üì∏ –†–µ–∑—É–ª—å—Ç–∞—Ç 
[hw14_ch1_check1]()

---

6. –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —à–∞–≥–∞

–ù–∞ –¥–∞–Ω–Ω–æ–º —ç—Ç–∞–ø–µ:
	‚Ä¢	ClickHouse 25.3 LTS —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω
	‚Ä¢	–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä ch1 —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
	‚Ä¢	–∫–ª–∏–µ–Ω—Ç –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
	‚Ä¢	—Å–µ—Ä–≤–µ—Ä –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã

–ù–æ–¥–∞ ch1 –≥–æ—Ç–æ–≤–∞ –∫:
	‚Ä¢	—Å–æ–∑–¥–∞–Ω–∏—é —Ç–∞–±–ª–∏—Ü MergeTree
	‚Ä¢	–∑–∞–≥—Ä—É–∑–∫–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞
	‚Ä¢	–ø–æ—Å–ª–µ–¥—É—é—â–µ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –∏ ClickHouse Keeper

---



## üëâ –®–ê–ì 2 ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã MergeTree –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞ UK Price Paid**

–°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ UK Price Paid: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: [ClickHouse Dataset Docs](https://clickhouse.com/docs/getting-started/example-datasets/uk-price-paid)

–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã

```sql
CREATE TABLE default.uk_price_paid (
    price UInt32,
    date Date,
    postcode1 LowCardinality(String),
    postcode2 LowCardinality(String),
    type Enum8('terraced' = 1, 'semi-detached' = 2, 'detached' = 3, 'flat' = 4, 'other' = 0),
    is_new UInt8,
    duration Enum8('freehold' = 1, 'leasehold' = 2, 'unknown' = 0),
    addr1 String,
    addr2 String,
    street LowCardinality(String),
    locality LowCardinality(String),
    town LowCardinality(String),
    district LowCardinality(String),
    county LowCardinality(String)
) ENGINE = MergeTree
ORDER BY (postcode1, postcode2, addr1, addr2);
```
–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞

```sql
INSERT INTO default.uk_price_paid
SELECT
    toUInt32(price_string) AS price,
    parseDateTimeBestEffortUS(time) AS date,
    splitByChar(' ', postcode)[1] AS postcode1,
    splitByChar(' ', postcode)[2] AS postcode2,
    transform(a, ['T', 'S', 'D', 'F', 'O'], ['terraced', 'semi-detached', 'detached', 'flat', 'other']) AS type,
    b = 'Y' AS is_new,
    transform(c, ['F', 'L', 'U'], ['freehold', 'leasehold', 'unknown']) AS duration,
    addr1,
    addr2,
    street,
    locality,
    town,
    district,
    county
FROM url(
    'http://prod1.publicdata.landregistry.gov.uk.s3-website-eu-west-1.amazonaws.com/pp-complete.csv',
    'CSV',
    'uuid_string String,
    price_string String,
    time String,
    postcode String,
    a String,
    b String,
    c String,
    addr1 String,
    addr2 String,
    street String,
    locality String,
    town String,
    district String,
    county String,
    d String,
    e String'
) SETTINGS max_http_get_redirects=10;
```

–°–∫—Ä–∏–Ω—à–æ—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –∏ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞—Ç–∞—Å–µ—Ç–∞:
[hw14_create_tbl](), [hw14_insert_tbl1](), [hw14_insert_tbl2]()

