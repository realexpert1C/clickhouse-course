# üìö MergeTree –∏ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

## –¶–µ–ª–∏ –∑–∞–Ω—è—Ç–∏—è

- –ü—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã–±–∏—Ä–∞—Ç—å —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å `Primary Key` –∏ `Partition Key`

---

## üîÅ MergeTree: –∫–æ–Ω—Ü–µ–ø—Ü–∏—è –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**MergeTree** ‚Äî —ç—Ç–æ —Å–µ–º–µ–π—Å—Ç–≤–æ –¥–≤–∏–∂–∫–æ–≤ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ ClickHouse, —Ä–µ–∞–ª–∏–∑—É—é—â–µ–µ —Ñ–æ–Ω–æ–≤–æ–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –±–ª–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö (Parts).

### üîß –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã:
1. –î–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—É–ø–∞—é—Ç –≤ ClickHouse –∏ —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –Ω–∞ –±–ª–æ–∫–∏.
2. –°–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ `Primary Key`.
3. –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–∞–∫ `Part`.
4. –í —Ñ–æ–Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–ª–∏—è–Ω–∏–µ –±–ª–æ–∫–æ–≤ ‚Äî `Merge`.

### üß± –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Part:
- –ü—Ä–∏–º–µ—Ä –∏–º–µ–Ω–∏ Part: `20240101_1_1_0`
- –°–æ–¥–µ—Ä–∂–∏—Ç:
  - `primary.idx` ‚Äî –∏–Ω–¥–µ–∫—Å—ã –ø–æ `Primary Key`
  - `data.mrk3` ‚Äî –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è –≥—Ä–∞–Ω—É–ª
  - `data.bin` ‚Äî —Å–∞–º–∏ –¥–∞–Ω–Ω—ã–µ

---

## üîç –ò–Ω–¥–µ–∫—Å—ã

### Primary Key (—Ä–∞–∑—Ä–µ–∂–µ–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å):
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `minmax` –∏–Ω–¥–µ–∫—Å (sparse index)
- –î–∞–Ω–Ω—ã–µ —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –Ω–∞ **–≥—Ä–∞–Ω—É–ª—ã** (`index_granularity`)
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–µ–∏–≤–∞—Ç—å –Ω–µ–Ω—É–∂–Ω—ã–µ –±–ª–æ–∫–∏ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏

### Partition Key:
- –õ–æ–≥–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (—É–ø—Ä–æ—â–∞–µ—Ç —É–¥–∞–ª–µ–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç merge)
- **–í–∞–∂–Ω–æ**: `Partition Key` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –∏–Ω–¥–µ–∫—Å

---

## üßÆ –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

### –°—Ç—Ä–æ–∫–æ–≤—ã–µ:
- `String`, `FixedString(N)`

### –ß–∏—Å–ª–æ–≤—ã–µ:
- `UInt*`, `Int*`, `Float32/64`, `Decimal(P, S)`

### Bool –∏ Enum:
- `Bool`, `Enum`, `Enum16`

### –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è:
- `Date`, `Date32`
- `DateTime`, `DateTime64`

### –°—Ç—Ä—É–∫—Ç—É—Ä—ã:
- `Array(T)`, `Tuple(...)`, `Map(K, V)`

### –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ:
- `Nested`, `AggregateFunction(...)`, `Point`, `IPv4`, `JSON`, `Interval`

---

## üí° Aliases —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö

- `VARCHAR`, `CHAR` ‚Üí `String`
- `BIGINT` ‚Üí `Int64`, `SMALLINT` ‚Üí `Int16`
- –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ `system.data_type_families`

---

## üß™ Lightweight Delete (—Ñ–æ–Ω–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)

üîó –ò—Å—Ç–æ—á–Ω–∏–∫: [ClickHouse Lightweight Delete](https://clickhouse.com/docs/guides/developer/lightweight-delete)

### –ß—Ç–æ —ç—Ç–æ:
–ú–µ—Ö–∞–Ω–∏–∑–º –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫ –≤ ClickHouse. –í–º–µ—Å—Ç–æ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è, –¥–∞–Ω–Ω—ã–µ –ø–æ–º–µ—á–∞—é—Ç—Å—è –∫–∞–∫ —É–¥–∞–ª–µ–Ω–Ω—ã–µ –∏ –∏—Å–∫–ª—é—á–∞—é—Ç—Å—è –∏–∑ –∑–∞–ø—Ä–æ—Å–æ–≤.

### –ü—Ä–∏–Ω—Ü–∏–ø:
- –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Å–∫—Ä—ã—Ç—ã–π —Ñ–∏–ª—å—Ç—Ä –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- –£–¥–∞–ª–µ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ –¥–∏—Å–∫–µ –¥–æ —Å–ª–∏—è–Ω–∏—è (merge)
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ –≤—Å–µ–≥–æ Part (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –æ–±—ã—á–Ω–æ–π –º—É—Ç–∞—Ü–∏–∏)

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- –£–¥–∞–ª–µ–Ω–∏–µ –ª–æ–≥–∏—á–µ—Å–∫–æ–µ ‚Äî –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –Ω–∞ –¥–∏—Å–∫–µ
- –¢—Ä–µ–±—É–µ—Ç Merge –¥–ª—è —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
- –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ç–∞–±–ª–∏—Ü (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ `MergeTree`)

### –ü—Ä–∏–º–µ—Ä:
```sql
ALTER TABLE events DELETE WHERE event_type = 'test';
```

## ‚úÖ –ò—Ç–æ–≥–∏
-	MergeTree —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ö—Ä–∞–Ω–∏—Ç –±–æ–ª—å—à–∏–µ –æ–±—ä–µ–º—ã –¥–∞–Ω–Ω—ã—Ö —Å —Ñ–æ–Ω–æ–≤—ã–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ–º.
- –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –Ω—É–∂–Ω–æ –ø–æ–¥–±–∏—Ä–∞—Ç—å –ø–æ –∑–∞–¥–∞—á–∞–º: –ø–æ –æ–±—ä–µ–º—É, —Å–∫–æ—Ä–æ—Å—Ç–∏, —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.
- Lightweight Delete –ø–æ–∑–≤–æ–ª—è–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —É–¥–∞–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ Part-–æ–≤.
